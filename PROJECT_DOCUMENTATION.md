# Project Documentation

## 1. Project Overview

This project is a **web-based Chatbot Application** meant to serve as a "Digital Playground" learning aid. It features an interactive AI assistant specifically designed to be a friendly "Playground Guide" that helps users with self-study projects using playground metaphors (Sandbox, Slide, Swing Set, etc.).

The application is structured as a **Monorepo** containing both the Frontend (Client) and Backend (Server).

## Quick Start

To start the project immediately (after installing dependencies and setting environment variables):

```bash
bun run dev
```

## 2. Architecture and Structure

### Directory Structure

The project uses a workspace-based monorepo structure managed by **Bun** (or npm).

#### Visual Directory Structure

```text
my-app/
├── packages/
│   ├── client/           # Frontend Application (React + Vite)
│   │   ├── src/
│   │   │   ├── components/
│   │   │   │   ├── chat/
│   │   │   │   │   ├── ChatBot.tsx
│   │   │   │   │   ├── ChatInput.tsx
│   │   │   │   │   ├── TypingIndicator.tsx
│   │   │   │   │   └── chatMessages.tsx
│   │   │   │   └── ui/
│   │   │   │       └── button.tsx
│   │   │   ├── public/
│   │   │   └── ...
│   └── server/           # Backend Application (Express)
│       ├── controllers/
│       │   └── chat.controller.ts
│       ├── services/
│       │   └── chat.service.ts
│       ├── repositories/
│       ├── prompts/      # AI personas and system prompts
│       └── index.ts
├── index.ts              # Root entry point (concurrent runner)
├── package.json          # Workspace configuration
└── ...
```

- **`packages/client`**: The frontend application.
- **`packages/server`**: The backend API server.
- **`prompts`** (within server): Contains the system prompts and personas for the AI.

### Key Components

- **Client (Frontend)**:
   - Built with **React 19**, **Vite**, and **Tailwind CSS 4**.
   - Handles user input and displays chat history.
   - Uses **Axios** for API requests.
   - Configured to proxy `/api` requests to the backend server.
- **Server (Backend)**:
   - Built with **Express.js** and **TypeScript**.
   - Integrates with **OpenAI** API to generate responses.
   - Validator: **Zod** is used for request validation.
   - Repository: Uses an in-memory repository to track conversation states.

### Technology Stack

- **Runtime/Package Manager**: Bun (recommended) / Node.js
- **Frontend**: React, Vite, Tailwind CSS, Lucide React (icons).
- **Backend**: Express, OpenAI SDK.
- **Language**: TypeScript.

## 3. Core Functionality & Flow

### Execution Flow (Chat Interaction)

1. **User Input**: The user types a message in the chat interface (Frontend).
2. **Request**: The Client sends a `POST` request to `/api/chat` with:
   - `prompt`: The user's message.
   - `conversationId`: A generic UUID generated by the client to track the session.
3. **Proxy**: The Vite development server proxies this request to `http://localhost:3000/api/chat`.
4. **Validation**: The Server receives the request and validates the body using **Zod** (ensures `prompt` exists and `conversationId` is a UUID).
5. **Processing**:
   - The `chatService` constructs a system instruction based on `Digital_Playground_System_Prompt.md`, defining the AI's persona.
   - It calls the OpenAI API, passing the current prompt and the `previous_response_id` (retrieved from the repository) to maintain conversation continuity.
6. **Persistence**: The new `response_id` from OpenAI is saved in the in-memory `conversationRepository` mapped to the `conversationId`.
7. **Response**: The server returns the AI's generated textual response to the Client.
8. **Display**: The Client appends the new message to the chat history and displays it.

## 4. API Endpoints

The backend exposes the following RESTful endpoints.

### 1. Health/Test Endpoint

- **Method**: `GET`
- **Path**: `/api/hello`
- **Purpose**: Simple health check to verify the API is reachable.
- **Response**:
   ```json
   {
      "message": "Hello World!"
   }
   ```

### 2. Chat Endpoint

- **Method**: `POST`
- **Path**: `/api/chat`
- **Purpose**: Sends a user message to the AI and retrieves a response.
- **Request Body** (JSON):
   ```json
   {
      "prompt": "Hello, how does the slide work?",
      "conversationId": "123e4567-e89b-12d3-a456-426614174000"
   }
   ```

   - `prompt` (string, required): 1-1000 characters.
   - `conversationId` (string, UUID, required): Unique identifier for the chat session.
- **Response** (JSON):
   ```json
   {
      "message": "The Slide is like a data pipeline..."
   }
   ```
- **Error Responses**:
   - `400 Bad Request`: If validation fails (e.g., missing prompt).
   - `500 Internal Server Error`: If the OpenAI API call fails.

## 5. Database Schema

Currently, the project **does not use a persistent database**.

- **Repository**: `packages/server/repositories/conversation.repository.ts`
- **Storage**: In-memory `Map<string, string>`.
- **Schema**:
   - **Key**: `conversationId` (string/UUID)
   - **Value**: `lastResponseId` (string, ID from OpenAI)
- **Note**: Since storage is in-memory, all conversation history context is lost if the server is restarted.

## 6. Configuration and Setup Notes

### Prerequisites

- **Bun** (recommended) or **Node.js** installed.
- **OpenAI API Key**.

### Setup Instructions

1. **Install Dependencies**:
   Run the following command from the root directory:

   ```bash
   bun install
   # or
   npm install
   ```

2. **Environment Variables**:
   You must configure the backend environment variables.
   - Navigate to `packages/server`.
   - Create a `.env` file (copy from `.env.example` if it exists).
   - Add your OpenAI API key and (optional) port:
      ```env
      OPENAI_API_KEY=sk-your-api-key-here
      PORT=3000
      ```

3. **Run Locally**:
   From the **root** directory, run the development script. This uses `concurrently` to start both the client and server.

   ```bash
   bun run dev
   # or
   npm run dev
   ```

4. **Access the App**:
   - Frontend: `http://localhost:5173` (default Vite port).
   - Backend: `http://localhost:3000`.
